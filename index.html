
<html>
  	<head>
	    <title>User Study</title>
	    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js'></script>
	    <link href='css/bootstrap.min.css' rel='stylesheet'>
	    <link href='css/homepage_style.css' rel='stylesheet'>
	    <script src='js/bootstrap.min.js'></script>
      <script src="js/FileSaver.min.js"></script>
      <link href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900,100italic,100,300,300italic,400italic,500italic,900italic,700italic' rel='stylesheet' type='text/css'>
	</head>

	<body>
  <div class='container', style="padding-top: 100px">
    <div class='row'>
        <center><div style='font-size: 50px;color:red; padding-left: 100px'>请点击你认为更自然的图片！</div></center>
        <center>
            <div style='color:red'>图片: <div id='image_idx'>0</div> </div>
            <div style='color:red'> 剩余时间 </div>
            <div id='time'> 10s </div>
        </center>
    </div>
    <div class='row' style='padding-top: 50px'>        
        <div class="col-xs-2 col-md-2" >
        </div>
        <div class="col-xs-4 col-md-4" >
          <center>
          <img id="left_image" style="width: 256px;outline:0px" src="prac/left_0.png">
          </center>
        </div>
        
        <div class=class="col-xs-4 col-md-4">
          <center>
            <img id="right_image" style="width: 256px; outline:0px"  src="prac/right_0.png">
          </center>
        </div>
    </div>
  </div>
  <script>
  var t1 = window.setInterval(timer_str, 1000);
  var remain_time = 10;
  var curr_index = 0;
  
  var curr_flag = -1
  var img_folder = 'prac' <!-- prac, rand, top1 -->
  var practice_num = 10
  var real_num = 50
  var total_num = practice_num
  var answer_list = new Array(practice_num+real_num);

  function timer_str(){
    remain_time = remain_time - 1;
    if(remain_time<=0){
      finishTimeSelect();
    }else{
      $("#time").html(" " + remain_time + " s");
    }
  }
  function wait(ms){
   var start = new Date().getTime();
   var end = start;
   while(end < start + ms) {
     end = new Date().getTime();
  }
  }
  var valChecked = function() {
    var checkval = $("input:checked").val();
  };
  
  var reset = function(){
    document.getElementById("left_image").style.outline='0px';
    document.getElementById("right_image").style.outline='0px';
    curr_flag = -1;
    remain_time = 10;
  }

  var nextPage = function(){
      reset();
      curr_src = $("#left_image").attr("src");
      curr_folder = curr_src.substring(0,4)
      curr_index = parseInt(curr_src.substring(10,curr_src.length-4));
      if(curr_folder=='prac' && curr_index==(practice_num-1)){
        img_folder = 'top1';
        curr_index = -1;
        total_num = real_num
      }
      next_idx = curr_index + 1;
      if(next_idx < total_num){
        $("#time").html(""+remain_time + " s");
        t1 = window.setInterval(timer_str, 1000);
                        
        $("#left_image").attr('src', img_folder+"/left_" + next_idx + ".png")
        $("#right_image").attr('src', img_folder+ "/right_" + next_idx + ".png")
        if (curr_folder=='prac'){
          $('#image_idx').html(""+next_idx)  
        }else{
          real_next_idx = practice_num + next_idx
          $('#image_idx').html(""+real_next_idx)  
        }
        
      }else{
        result_content = ""
        for(i = 1; i <= practice_num+real_num; i++){
          if(i <= practice_num){
            result_content = result_content + "practice idx: "+i+",rst:"+answer_list[i-1]+"\n";
          }else{
            real_i = i - practice_num;
            result_content = result_content + "real idx: "+real_i+",rst:"+answer_list[i-1]+"\n";
          }
        }
        var blob = new Blob([result_content], {type: "text/plain;charset=utf-8"});
        saveAs(blob, "answers.txt")
        alert("感谢完成所有实验，务必下载页面弹出的txt并发送给我们!");
      }
  }

  var finishselectLeft = function(){
    curr_src = $("#left_image").attr('src');
    curr_folder = curr_src.substring(0,4);
    curr_index = parseInt(curr_src.substring(10,curr_src.length-4));
    curr_flag = 0;
    if(curr_folder!='prac'){
      answer_list[curr_index+practice_num] = curr_flag;
    }else{
      answer_list[curr_index] = curr_flag;
    }
    console.log(""+curr_flag + ' is selected for index: ' + curr_index);
    window.clearInterval(t1);
    nextPage();
  };

  var finishselectRight = function(){
    curr_src = $("#left_image").attr('src');
    curr_folder = curr_src.substring(0,4);
    curr_index = parseInt(curr_src.substring(10,curr_src.length-4))
    if (curr_index<0 || curr_index > total_num){
      alert("程序出错，请通知我们！")
    }
    curr_flag = 1
    if(curr_folder!='prac'){
      answer_list[curr_index+practice_num] = curr_flag;
    }else{
      answer_list[curr_index] = curr_flag;
    }
    console.log(""+curr_flag + ' is selected for index: ' + curr_index);
    window.clearInterval(t1);
    nextPage();
  };

  var finishTimeSelect = function(){
    curr_src = $("#left_image").attr('src');
    curr_folder = curr_src.substring(0,4);
    curr_index = parseInt(curr_src.substring(10, curr_src.length-4))
     if(curr_folder!='prac'){
      answer_list[curr_index+practice_num] = curr_flag;
    }else{
      answer_list[curr_index] = curr_flag;
    }
    if(curr_flag==-1){
      alert("请10s内完成选择!")
    }
    console.log(""+curr_flag + ' is selected for index: ' + curr_index);
    window.clearInterval(t1);
    nextPage();
  };

  var finishSelect = function(){
    curr_src = $("#left_image").attr('src');
    curr_index = parseInt(curr_src.substring(10,curr_src.length-4))
    flag = -1
    if($("input:checked").length==1){
      var checkval = $("input:checked").val();
      if(checkval=="left"){
        flag=0;
      }else{
        flag=1;
      }      
      console.log(""+flag + ' is selected for index: ' + curr_index);
      window.clearInterval(t1);
    }else{
      alert("请10s内完成选择!")
      window.clearInterval(t1);
    }
    answer_list[curr_index-1] = flag;
    nextPage();
  };
  $("#left_image").on( "click", finishselectLeft);
  $("#right_image").on( "click", finishselectRight);
  
</script>
	</body>
</html>
